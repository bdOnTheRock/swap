



Sub borne()
'
' borne Macro
'
' Touche de raccourci du clavier: Ctrl+b
'

refreshDyn

courant = Sheets("_c").Cells(1, 10).Value
Dim last As Integer
last = courant

Dim i As Integer

For i = courant To 10000

 If Sheets("_c").Cells(i, 1) <= 0 Then
 Exit For

 End If
  last = i
Next

Sheets("_c").Cells(1, 11).Value = Sheets("_c").Cells(last, 2)

borneP10 = 10 * Int(last / 10)
If borneP10 < last Then borneP10 = borneP10 + 10

borneP50 = 50 * Int(last / 50)
If borneP50 < last Then borneP50 = borneP50 + 50

borneMV = borneP10 - 60
borneMC = borneP10 - 110
borneMCV = borneP10 - 160
borneM5C = borneP50 - 550
borneMM5C = borneP50 - 1550



calc "cXX", last - 20, last
calc "cV", last - 50, last
calc "c", courant, last
calc "cC", last - 100, last
calc "cCV", borneMCV, last
calc "c5C", borneM5C, last
calc "cM5C", borneMM5C, last


    
 
End Sub

Sub calc(ByVal sheet As String, ByVal borneM As Integer, ByVal borneP As Integer)
    
    If borneM < 2 Then borneM = 2
    'Sheets(sheet).Select
    
    setBorne 1, "A", borneM, borneP, sheet
   
    setBorne 2, "I", borneM, borneP, sheet
    setBorne 3, "F", borneM, borneP, sheet
    setBorne 4, "E", borneM, borneP, sheet
    
    setBorneX 1, borneM, sheet
    setBorneX 2, borneM, sheet
    
     setBorneY 1, borneM, borneP, sheet, False
    setBorneY 6, borneM, borneP, sheet, True

End Sub


Sub setBorne(ByVal index As Integer, ByVal col As String, ByVal borneM As Integer, ByVal borneP As Integer, ByVal sheet As String)

Sheets(sheet).SeriesCollection(index).Values = "=_c!$" + col + "$" + CStr(borneM) + ":$" + col + "$" + CStr(borneP)

End Sub

Sub setBorneX(ByVal index As Integer, ByVal borneM As Integer, ByVal sheet As String)

Sheets(sheet).SeriesCollection(index).XValues = "=_c!$H$" + CStr(borneM) + ":$H$10000"

End Sub

Sub setBorneY(ByVal col As Integer, ByVal borneM As Integer, ByVal borneP As Integer, ByVal sheet As String, ByVal secondAxe As Boolean)
Min = Sheets("_c").Cells(borneM, col)
Max = Min

For i = borneM To borneP
    y = Sheets("_c").Cells(i, col)
    If y > Max Then
        Max = y
    Else:
        If y < Min Then Min = y
    End If
    
Next

If Min = Max Then GoTo Ex
Delta = (Max - Min) / 8
coeff = 1
While Delta < 1
    Delta = Delta * 10
    coeff = 10 * coeff
Wend

While Delta > 10
    Delta = Delta / 10
    coeff = 0.1 * coeff
Wend

'1.235
If Delta > 5 Then
    Delta = 10
Else:
    If Delta > 2 Then
    Delta = 5
Else:
    Delta = 2
End If
End If
minv = Int(coeff * Min)
maxv = Int(coeff * Max) + 1

minv = Int(minv / Delta) * Delta

courant = minv
While courant < maxv
courant = courant + Delta
Wend

borneMin = minv / coeff
borneMax = courant / coeff

If secondAxe Then
Sheets(sheet).Axes(xlValue, xlSecondary).MinimumScale = borneMin
Sheets(sheet).Axes(xlValue, xlSecondary).MaximumScale = borneMax
Sheets(sheet).Axes(xlValue, xlSecondary).MajorUnit = Delta / coeff
Else

Sheets(sheet).Axes(xlValue).MinimumScale = borneMin
Sheets(sheet).Axes(xlValue).MaximumScale = borneMax
Sheets(sheet).Axes(xlValue).MajorUnit = Delta / coeff
End If

Ex:
End Sub
